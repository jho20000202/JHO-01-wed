<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>預計進料登記</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="styles.css">

<style>
/* ===========================
   深色日曆彈窗 Dark Calendar
=========================== */
#calendarOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

#calendarBox {
    background: #1c2433;
    padding: 18px;
    border-radius: 18px;
    width: 88%;
    max-width: 350px;
    color: #fff;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    animation: fadeIn 0.25s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.92); }
    to   { opacity: 1; transform: scale(1); }
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 18px;
    margin-bottom: 12px;
}

.cal-btn {
    background: #2f7dff;
    border-radius: 10px;
    padding: 6px 10px;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
    margin-top: 10px;
}

.day-name {
    text-align: center;
    color: #aaa;
    font-size: 13px;
}

.day-cell {
    text-align: center;
    padding: 10px 0;
    border-radius: 10px;
    cursor: pointer;
    background: #141a28;
}

.day-cell:hover {
    background: #2f7dff;
}

.day-disabled {
    opacity: 0.2;
    pointer-events: none;
}

#openCalendarBtn {
    cursor: pointer;
}
</style>

</head>
<body>

<!-- ======================
     頂部
====================== -->
<div class="top-bar">
    <div class="top-bar-title">預計進料登記</div>
    <a href="index.html" class="top-btn">返回主畫面</a>
</div>


<!-- ======================
     輸入區
====================== -->
<div class="screen-card">

    <div class="section-title">構件編號</div>
    <input id="itemIdInput" class="input-bar" placeholder="例如 A-001">

    <div class="section-title">預計到貨日期</div>

    <!-- ⬇⬇⬇ 點擊後彈出日曆 -->
    <input id="dateInput"
           class="input-bar"
           placeholder="點擊選擇日期"
           readonly
           style="cursor:pointer;background:#1c2433;"
    >

    <button id="submitBtn" class="primary-btn full" style="margin-top:12px;">
        送出
    </button>
</div>


<!-- ======================
     預計進料清單
====================== -->
<div class="screen-card">
    <div class="section-title">目前預計進料清單</div>

    <div id="planList"></div>

    <div id="loadingSpinner">
        <svg viewBox="0 0 24 24">
            <path fill="#ccc" d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 4a6 6 0 110 12 6 6 0 010-12z"/>
        </svg>
    </div>

    <div id="loadMessage">已載入全部資料</div>
</div>


<!-- ======================
     深色日曆彈窗
====================== -->
<div id="calendarOverlay">

    <div id="calendarBox">
        
        <div class="calendar-header">
            <div id="prevMonth" class="cal-btn">〈</div>
            <div id="calTitle">2025 / 01</div>
            <div id="nextMonth" class="cal-btn">〉</div>
        </div>

        <div class="calendar-grid" id="calendarGrid">
            <!-- 會由 JS 自動插入 -->
        </div>

        <button id="closeCalendar" class="danger-btn full" style="margin-top:15px;">關閉</button>

    </div>

</div>


<!-- ======================
     Supabase + 邏輯
====================== -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="planned.js"></script>

<script>
/* =========================
   深色日曆：初始化
========================= */
const dateInput = document.getElementById("dateInput");
const overlay = document.getElementById("calendarOverlay");
const grid = document.getElementById("calendarGrid");
const calTitle = document.getElementById("calTitle");

let current = new Date();
current.setDate(1);

/* === 打開日曆 === */
dateInput.addEventListener("click", () => {
    overlay.style.display = "flex";
    renderCalendar();
});

/* === 關閉日曆 === */
document.getElementById("closeCalendar").addEventListener("click", () => {
    overlay.style.display = "none";
});


/* =========================
   渲染日曆
========================= */
function renderCalendar() {
    grid.innerHTML = "";

    const year = current.getFullYear();
    const month = current.getMonth();

    calTitle.textContent = `${year} / ${String(month+1).padStart(2,"0")}`;

    const first = new Date(year, month, 1);
    const last = new Date(year, month+1, 0);

    const firstDay = first.getDay();
    const days = last.getDate();

    // 星期抬頭
    const names = ["日","一","二","三","四","五","六"];
    names.forEach(n => {
        const e = document.createElement("div");
        e.className = "day-name";
        e.textContent = n;
        grid.appendChild(e);
    });

    // 前空白
    for (let i=0; i<firstDay; i++) {
        const blank = document.createElement("div");
        blank.className = "day-cell day-disabled";
        grid.appendChild(blank);
    }

    // 日期
    for (let d=1; d<=days; d++) {
        const cell = document.createElement("div");
        cell.className = "day-cell";
        cell.textContent = d;

        cell.addEventListener("click", () => {
            const mm = String(month+1).padStart(2,"0");
            const dd = String(d).padStart(2,"0");
            dateInput.value = `${year}-${mm}-${dd}`;
            overlay.style.display = "none";
        });

        grid.appendChild(cell);
    }
}

/* 月份切換 */
document.getElementById("prevMonth").addEventListener("click", () => {
    current.setMonth(current.getMonth() - 1);
    renderCalendar();
});
document.getElementById("nextMonth").addEventListener("click", () => {
    current.setMonth(current.getMonth() + 1);
    renderCalendar();
});
</script>

</body>
</html>
