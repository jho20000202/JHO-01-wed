<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>進度表</title>
    <link rel="stylesheet" href="styles.css">

    <style>
        body { padding: 20px; }

        /* Header ----------------------- */
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header-title {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        .back-btn {
            padding: 10px 20px;
            background: #2f3340;
            color: #fff;
            border-radius: 12px;
            cursor: pointer;
        }

        /* Dropdown --------------------- */
        .select-box {
            width: 100%;
            padding: 14px;
            border-radius: 14px;
            background: #33343a;
            color: #fff;
            border: none;
            margin-bottom: 20px;
        }

        /* Progress Circles ------------- */
        .circle-row {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        .circle-box {
            width: 48%;
            padding: 20px 0;
            background: #2a2b31;
            border-radius: 20px;
            text-align: center;
            color: #fff;
        }
        .circle-num {
            font-size: 32px;
            margin-bottom: 6px;
        }
        .circle-label {
            color: #bbb;
        }

        /* Item List -------------------- */
        .item-card {
            background: #2a2b31;
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 18px;
            color: #fff;
        }
        .item-title {
            font-size: 18px;
            font-weight: bold;
        }
        .item-sub {
            margin-top: 6px;
            color: #bbb;
            font-size: 14px;
            line-height: 20px;
        }
    </style>

</head>

<body>

    <!-- Header -->
    <div class="header-row">
        <div class="header-title">進度表</div>
        <div class="back-btn" onclick="location.href='index.html'">返回主畫面</div>
    </div>

    <!-- Date Selector -->
    <select id="dateFilter" class="select-box" onchange="renderList()">
        <option value="all">全部日期</option>
        <option value="2025-01-01">2025-01-01</option>
        <option value="2025-01-02">2025-01-02</option>
        <option value="2025-01-03">2025-01-03</option>
    </select>

    <!-- Progress Circles -->
    <div class="circle-row">
        <div class="circle-box">
            <div class="circle-num" id="pIn">0%</div>
            <div class="circle-label">已進料</div>
            <div id="pInCount" class="circle-label">0 / 0</div>
        </div>

        <div class="circle-box">
            <div class="circle-num" id="pUse">0%</div>
            <div class="circle-label">已使用</div>
            <div id="pUseCount" class="circle-label">0 / 0</div>
        </div>
    </div>

    <!-- List -->
    <div id="itemList"></div>

    <script>
        // 【示範假資料】之後會接你 Supabase 的資料
        let records = [
            { id: "UV0E3", pos: "32-33/F", plan: "2025-01-01", used: "" },
            { id: "UV0E3", pos: "32-33/G", plan: "2025-01-01", used: "2025-01-03" },
            { id: "UV0V1", pos: "32-33/F", plan: "2025-01-02", used: "" },
            { id: "UV1B1", pos: "-",       plan: "2025-01-03", used: "2025-01-03" }
        ];

        function renderList() {
            const filter = document.getElementById("dateFilter").value;
            const list = document.getElementById("itemList");
            list.innerHTML = "";

            const filtered = filter === "all"
                ? records
                : records.filter(a => a.plan === filter);

            // 計算進度
            const total = filtered.length;
            const inCount = filtered.filter(a => a.plan).length;
            const useCount = filtered.filter(a => a.used).length;

            document.getElementById("pIn").innerText =
                total ? Math.round(inCount / total * 100) + "%" : "0%";

            document.getElementById("pUse").innerText =
                total ? Math.round(useCount / total * 100) + "%" : "0%";

            document.getElementById("pInCount").innerText = `${inCount} / ${total}`;
            document.getElementById("pUseCount").innerText = `${useCount} / ${total}`;

            // 渲染列表
            filtered.forEach(item => {
                const card = document.createElement("div");
                card.className = "item-card";

                card.innerHTML = `
                    <div class="item-title">${item.id}</div>
                    <div class="item-sub">
                        位置：${item.pos || "-"} <br>
                        預計：${item.plan || "-"} <br>
                        已使用：${item.used || "-"}
                    </div>
                `;

                list.appendChild(card);
            });
        }

        renderList();
    </script>

</body>
</html>
