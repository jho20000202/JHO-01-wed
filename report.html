<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>報表匯出</title>
    <link rel="stylesheet" href="styles.css">

    <style>
        body { padding: 20px; }

        /* Header */
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header-title {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        .back-btn {
            padding: 10px 20px;
            background: #2f3340;
            color: #fff;
            border-radius: 12px;
            cursor: pointer;
        }

        /* Select box */
        .select-box {
            width: 100%;
            padding: 14px;
            border-radius: 14px;
            background: #33343a;
            color: #fff;
            border: none;
            margin-bottom: 20px;
        }

        /* Search */
        .search-box {
            width: 100%;
            padding: 14px;
            border-radius: 14px;
            background: #2f3340;
            border: none;
            margin-bottom: 25px;
            color: #fff;
        }

        /* Buttons */
        .btn-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
        }
        .btn {
            flex: 1;
            padding: 14px;
            border-radius: 14px;
            margin-right: 10px;
            text-align: center;
            cursor: pointer;
            color: #fff;
        }
        .btn:last-child { margin-right: 0; }

        .btn-blue { background: #1e80ff; }
        .btn-gray { background: #3a3d47; }
        .btn-red { background: #d9534f; }

        /* List items */
        .item-card {
            background: #2a2b31;
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 18px;
            color: #fff;
        }
        .item-title {
            font-size: 18px;
            font-weight: bold;
        }
        .item-sub {
            margin-top: 6px;
            color: #bbb;
            font-size: 14px;
            line-height: 20px;
        }
    </style>
</head>

<body>

    <!-- Header -->
    <div class="header-row">
        <div class="header-title">進料確認</div>
        <div class="back-btn" onclick="location.href='index.html'">返回主畫面</div>
    </div>

    <!-- Sort -->
    <select id="sortMode" class="select-box" onchange="renderList()">
        <option value="latestUse">排序：已使用最後</option>
        <option value="latestIn">排序：已進料最後</option>
        <option value="nameAsc">排序：構件名稱 ↑</option>
        <option value="nameDesc">排序：構件名稱 ↓</option>
    </select>

    <!-- Search -->
    <input id="search" class="search-box" placeholder="搜尋：編號 / 位置 / 規格 / 材質 / 重量 / 數量" oninput="renderList()">

    <div style="color:#bbb; margin-bottom:15px;">今日無進料紀錄</div>

    <!-- Buttons -->
    <div class="btn-row">
        <div class="btn btn-gray" onclick="previewExcel()">預覽 Excel</div>
        <div class="btn btn-blue" onclick="exportExcel()">輸出今日進料 Excel</div>
    </div>

    <div class="btn btn-red" onclick="confirmClear()">清除今日進料</div>

    <!-- List -->
    <div id="itemList" style="margin-top:30px;"></div>

    <script>
        // ---------------------------
        //  示範資料（之後換成 Supabase）
        // ---------------------------
        let items = [
            { id: "UV0E3", pos: "32-33/F", spec: "PL25×500×650", weight: 89, qty: 1, in: "2025-01-03", use: "" },
            { id: "UV0E3", pos: "32-33/G", spec: "PL25×500×650", weight: 89, qty: 1, in: "2025-01-03", use: "2025-01-04" },
            { id: "UV0V1", pos: "32-33/F", spec: "RH300×300×10×15×5836.8", weight: 310, qty: 1, in: "", use: "" }
        ];

        function renderList() {
            const list = document.getElementById("itemList");
            const search = document.getElementById("search").value.toLowerCase();
            const sortMode = document.getElementById("sortMode").value;

            // 搜尋
            let filtered = items.filter(a =>
                (a.id + a.pos + a.spec + a.weight + a.qty)
                    .toLowerCase()
                    .includes(search)
            );

            // 排序
            if (sortMode === "latestUse") {
                filtered.sort((a, b) => (b.use || "") > (a.use || "") ? 1 : -1);
            }
            else if (sortMode === "latestIn") {
                filtered.sort((a, b) => (b.in || "") > (a.in || "") ? 1 : -1);
            }
            else if (sortMode === "nameAsc") {
                filtered.sort((a, b) => a.id.localeCompare(b.id));
            }
            else if (sortMode === "nameDesc") {
                filtered.sort((a, b) => b.id.localeCompare(a.id));
            }

            // 渲染
            list.innerHTML = "";
            filtered.forEach(item => {
                const card = document.createElement("div");
                card.className = "item-card";

                card.innerHTML = `
                    <div class="item-title">${item.id}</div>
                    <div class="item-sub">
                        位置：${item.pos}<br>
                        規格：${item.spec}<br>
                        重量：${item.weight}　數量：${item.qty}<br>
                        已進料：${item.in || "-"}<br>
                        已使用：${item.use || "-"}
                    </div>
                `;

                list.appendChild(card);
            });
        }

        renderList();

        // ---------------------------
        //  Button Actions
        // ---------------------------
        function previewExcel() {
            alert("（示範）即將預覽 Excel\n\n之後會串本地產生的 Excel Blob");
        }

        function exportExcel() {
            alert("（示範）已匯出 Excel\n\n後續接你 back.js 的 Excel 生成");
        }

        // 兩次確認
        let clearStep = 0;

        function confirmClear() {
            if (clearStep === 0) {
                alert("再次點擊即可清除今日進料！");
                clearStep = 1;
                return;
            }
            clearStep = 0;
            alert("今日進料已清除！");
        }
    </script>

</body>
</html>
